<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <title>Nervous System</title>
    <style>
        .card-container {
            display: flex;
            flex-wrap: wrap;
        }

        .scene-card {
            width: 75%;
        }

        .info-card {
            width: 25%;
        }

        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
    </style>
</head>
<body>
<button style="display: none" id="info-modal" type="button" class="btn btn-primary" data-bs-toggle="modal"
        data-bs-target="#exampleModal">
    Launch demo modal
</button>
<header class="p-3 mb-3 border-bottom">
    <div class="container">
        <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
            <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 text-dark text-decoration-none">
                <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap">
                    <use xlink:href="#bootstrap"></use>
                </svg>
            </a>
            <h1 class="text-center">Nervous System</h1>

        </div>
    </div>
</header>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Body Part</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="part"></p>
                <p id="description"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="card-container my-4 mx-2">
    <div class="card scene-card">
        <canvas id="renderCanvas"></canvas>
    </div>
    <div class="card info-card">
        <p class="py-3 text-center">Nervous System
        </p>
        <p class="px-4 text-justify" style="text-align: justify">
            The nervous system is a sophisticated network of cells and tissues responsible for transmitting signals throughout the body, facilitating communication between various organs, tissues, and systems. At its core are the brain and spinal cord, comprising the central nervous system (CNS), which orchestrates complex functions such as thought, memory, and movement regulation. The brain, encased within the skull, serves as the body's command center, interpreting sensory information, initiating responses, and coordinating bodily activities. The spinal cord, protected within the spinal column, acts as a conduit for nerve signals between the brain and the rest of the body, facilitating reflexes and involuntary actions. Surrounding the CNS is the peripheral nervous system (PNS), which includes nerves like the tibial nerve, sciatic nerve, and intercostal nerve.
        </p>
    </div>
</div>

<div class="container">
    <footer class="py-3 my-4">

        <p class="text-center text-muted py-4">Â© 2022 Nervous System, Inc</p>
    </footer>
</div>

<script src="https://cdn.babylonjs.com/babylon.js"></script>
<script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
<script>
    let clicked = document.getElementById('part');
    let description = document.getElementById('description');
    let modalButton = document.getElementById('info-modal')
    // Create Babylon.js engine
    const canvas = document.getElementById('renderCanvas');
    const engine = new BABYLON.Engine(canvas, true);

    const scene = new BABYLON.Scene(engine);
    scene.position = new BABYLON.Vector3(0, -5, 5); // Adjust values to fit your needs


    // TODO:  Change background to white
    scene.clearColor = new BABYLON.Color4.FromHexString("#FFFAFA");

    // Load GLTF model
    BABYLON.SceneLoader.ImportMesh("", "models/", "nervous_revised.glb", scene, function (meshes) {
        meshes[0].isPickable = true;

        const boundingBox = meshes[0].getBoundingInfo().boundingBox;

        const margin = 20;
        const distance = (boundingBox.maximum.z - boundingBox.minimum.z) / 2 + margin;

        const camera = scene.activeCamera;
        camera.position.z = distance;

        handleDisplay(scene, -0.087, 0.624, -0.123, 'Tibial Nerve', 'Some Data for some part')
        handleDisplay(scene, 0.061, 0.865, -0.14, 'Sciatic Nerve', 'Some Data for some part')
        handleDisplay(scene, 0.0153, 1.73, 0.019, 'Brain', 'Some Data for some part')
        handleDisplay(scene, 0.00125, 1.349, -0.1297, 'Spinal Cord', 'Some Data for some part')
        handleDisplay(scene, 0.07, 1.222, -0.1, 'Intercostal Nerve', 'Some Data for some part')


        scene.onPointerDown = function (evt, pickResult) {
            if (pickResult.hit) {
                // Get the clicked position in 3D space
                const clickedPosition = pickResult.pickedPoint;
                console.log("Clicked position:", clickedPosition);
            }
        };
    });

    var light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
    light.intensity = 0.7;

    // Create a fixed camera with initial position
    const camera = new BABYLON.ArcRotateCamera("Camera", Math.PI / 2, Math.PI / 2, 10, BABYLON.Vector3.Zero(), scene);
    camera.setPosition(new BABYLON.Vector3(-1, 3, 1)); // Set camera position to (0, 0, 0)
    camera.target = BABYLON.Vector3.Zero();
    camera.attachControl(canvas, false); // Don't attach control

    // Disable camera panning and rotation (handled in drag)
    camera.panningIsEnabled = false;
    camera.allowPicking = false;
    camera.allowInputs = false; // Prevent accidental camera input

    // Drag sensitivity
    const dragSensitivity = 0.01;

    // Function to handle mouse drag
    let isDragging = false;
    let lastX, lastY;
    canvas.addEventListener('mousedown', function (event) {
        isDragging = true;
        lastX = event.clientX;
        lastY = event.clientY;
    });

    canvas.addEventListener('mouseup', function () {
        isDragging = false;
    });

    canvas.addEventListener('mousemove', function (event) {
        if (isDragging) {
            const deltaX = event.clientX - lastX;
            const deltaY = event.clientY - lastY;

            // Update camera rotation based on drag delta and sensitivity
            camera.rotation.y += deltaX * dragSensitivity;
            camera.rotation.x += deltaY * dragSensitivity;

            // Clamp camera rotation within limits (optional)
            // camera.rotation.x = Math.max(Math.min(camera.rotation.x, Math.PI / 2), -Math.PI / 2);

            lastX = event.clientX;
            lastY = event.clientY;
        }
    });


    const data = {
        'Tibial Nerve': 'A major nerve of the lower limb that originates from the sciatic nerve and branches to supply muscles and skin on the posterior surface of the leg and sole of the foot. It plays a crucial role in motor function and sensation in the lower extremities.',
        'Sciatic Nerve': 'The largest nerve in the human body, originating from the lower lumbar and sacral regions of the spine and extending down the back of the thigh. It provides motor innervation to the muscles of the thigh and leg and sensory innervation to the skin of the lower leg, foot, and part of the thigh.',
        'Brain': 'The central organ of the nervous system located within the skull. It serves as the command center for the body, controlling thoughts, emotions, memory, speech, and voluntary movements. Additionally, it regulates involuntary functions such as heartbeat, breathing, and digestion.',
        'Spinal Cord': 'A long, thin, tubular bundle of nervous tissue that extends from the base of the brain down the vertebral column. It serves as a conduit for nerve signals between the brain and the rest of the body, relaying sensory information from the peripheral nerves to the brain and transmitting motor commands from the brain to the muscles and glands.',
        'Intercostal Nerve': 'Nerves that run along the ribcage and are responsible for supplying motor and sensory innervation to the muscles between the ribs, as well as to the skin and muscles of the chest and abdomen. They play a crucial role in breathing and trunk movement.'
    };



    function handleDisplay(scene, x, y, z, label, descriptionData) {
        const material = new BABYLON.StandardMaterial("material", scene);

        const circle = BABYLON.MeshBuilder.CreateDisc("circle", {
            radius: 0.04,
            tessellation: 50,
            sideOrientation: BABYLON.Mesh.DOUBLESIDE
        }, scene);
        circle.position.x = x;
        circle.position.y = y;
        circle.position.z = z;
        circle.material = material; // Apply the material to the circle mesh

        // Add event listener for pointer down (click) events
        circle.actionManager = new BABYLON.ActionManager(scene);
        circle.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger, function (evt) {
            // Perform actions when the circle is clicked
            clicked.innerText = label
            description.innerText = data[label]
            modalButton.click()
        }));

    }

    // Adjust camera zoom speed
    camera.wheelPrecision = 50; // Set the desired zoom sensitivity

    // Run the render loop
    engine.runRenderLoop(function () {
        scene.render();
    });

    // Handle window resize
    window.addEventListener('resize', function () {
        engine.resize();
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>
</html>
